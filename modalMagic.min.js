angular.module("dc.modalMagic",["ui.bootstrap"]);angular.module("dc.modalMagic").factory("modalMagic",["$injector","$q",function(e,t){var n,r;n=function(){function n(t){this.modalPromise=null;this.data=t.data||{};this.templateUrl=t.templateUrl||function(){throw new Error("need templateUrl")}();this.isValid=t.isValid||function(e){return true};this.onSubmit=t.onSubmit||function(e){return true};this.$modal=e.get("$modal")}n.prototype.asPromise=function(e,n){var r,i;i=e(n);if(i&&i.then){return i}else{r=t.defer();if(i){r.resolve(i)}else{r.reject(i)}return r.promise}};n.prototype.open=function(){return this.onlyOne().then(function(e){return function(t){e.data=t;return e.data}}(this))["catch"](function(e){return function(t){e.modalPromise=null;console.error("YOU CANNOT ESCAPE YOUR DESTINY",t);return e.open()}}(this))};n.prototype.onlyOne=function(){if(this.modalPromise){return this.modalPromise}this.modalPromise=this.openModal()["catch"](function(e){return function(){return e.data}}(this)).then(function(e){return function(t){return e.asPromise(e.isValid,t)}}(this));return this.modalPromise.then(function(e){this.modalPromise=null;return e})["catch"](function(e){this.modalPromise=null;throw e})};n.prototype.openModal=function(){var e,t;t=this;e=this.$modal.open({templateUrl:this.templateUrl,controller:["$scope","$modalInstance",function(e,n){e.data=t.data;e.submit=function(){var r,i,s;i=angular.copy(t.data);for(r in i){s=i[r];if(e.data[r]!==void 0){i[r]=e.data[r]}}return t.asPromise(t.onSubmit,i).then(function(e){return n.close(e)})["catch"](function(e){return n.dismiss("onSubmit failed:"+e)})};return e.close=function(){return n.dismiss("closed")}}]});return e.result};return n}();r={};return{get:function(e,t){if(r[e]){return r[e]}r[e]=new n(t);return r[e]}}}])